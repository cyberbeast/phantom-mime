<html>

<head>
  <script src="http://localhost:8080/socket.io/socket.io.js"></script>
  <script type="text/javascript" src="https://rawgithub.com/craftyjs/Crafty/release/dist/crafty-min.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="../client/assets/js/game.js"></script>
  <script src="../client/assets/js/components.js"></script>
  <script src="../client/assets/js/scenes.js"></script>
  <script src="../client/assets/js/game_grid.js"></script>
  <script>
    console.log('Loading game...');
    var turn = null;

    $(function () {
      //var pObject
      console.log("Establishing socket connection now...");
      var socket = io('/game');
      var myIdentity;

      socket.on('yourIdentity', function (data) {
        myIdentity = data
      })

      socket.emit('gameInit', {
        data: "from Game"
      });

      socket.on('gameInitResponse', function (data) {
        console.log(data);
        data.identity = myIdentity
        Game.start(socket, data);
        Game.create_players();
      })

      socket.on('newMove', function(data){
          //get player in previous turn
          var prev_turn = data['turn'] === 'player1' ? 'player2': 'player1';
          var current_player = Crafty(prev_turn);
          //render their move
          Game.move(current_player, data['move']);
          //toggle the turn again
          turn = data['turn'];
      });

      $(document).keydown(function (e) {
        console.log(myIdentity, typeof (myIdentity))
        //get player entity whose turn it is
        var current_player = Crafty(turn);
        //render move if the current use is the current player
        if (myIdentity === current_player.identity) {
          Game.move(current_player, e.keyCode);
          //toggle turn after move is rendered
          var turn = turn === 'player1' ? 'player2': 'player2'; 
          //emit to other player recent move
          socket.emit('gameServerListener', { event: 'newMove', data: { player: turn, move: e.keyCode }  });
        }
      });

      socket.on('success', function (data) {
        console.log("REGISTERED with: " + data)
      })
    });
  </script>
</head>

<body>
  <div>
  </div>
</body>

</html>
